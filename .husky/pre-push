#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running comprehensive pre-push checks..."
echo ""

# 1. Linting & Formatting (catches code style issues)
echo "â†’ [1/6] Linting code..."
bun run check:backend || exit 1
bun run check:frontend || exit 1
echo "âœ“ Linting passed"
echo ""

# 2. Type Checking (catches type errors)
echo "â†’ [2/6] Type checking..."
bun run typecheck:backend || exit 1
bun run typecheck:frontend || exit 1
echo "âœ“ Type checking passed"
echo ""

# 3. Running Tests (catches logic bugs & runtime errors)
echo "â†’ [3/6] Running tests..."
bun run test || exit 1
echo "âœ“ Tests passed"
echo ""

# 4. Security Audits (catches vulnerabilities)
echo "â†’ [4/6] Running security audits..."
bun run audit:all || exit 1
echo "âœ“ Security audits passed"
echo ""

# 5. Builds (catches build failures)
echo "â†’ [5/6] Running builds..."
bun run build:sdk || exit 1
bun run build:frontend || exit 1
bun run build:storybook || exit 1
echo "âœ“ Builds passed"
echo ""

# 6. Docker Check (catches containerization issues)
echo "â†’ [6/6] Verifying Docker build..."
if docker info > /dev/null 2>&1; then
    docker build . --file Dockerfile --quiet > /dev/null || exit 1
    echo "âœ“ Docker build passed"
else
    echo "âš ï¸ Docker is not running. Skipping Docker build check."
fi
echo ""

echo "âœ… All pre-push checks passed! Safe to push."
